*************************** COMANDOS *********************************
-- Qual bd estou?              
SELECT DB_NAME();

-- Listar todos os bd
SELECT name FROM sys.databases ORDER BY name;

-- Conecte ao banco nome_do_banco
USE nome_do_banco;

-- Informa√ß√µes completas
EXEC sp_helpdb 'nome_do_banco';

-- pesquisa Top 10 linhas
SELECT TOP 10 * FROM ESCOLAS1225

Bancos de Dados
sql
-- Criar banco de dados
CREATE DATABASE NomeBanco;

-- Alterar banco
ALTER DATABASE NomeBanco 
MODIFY NAME = NovoNome;

-- Excluir banco
DROP DATABASE NomeBanco;

-- Backup
BACKUP DATABASE NomeBanco 
TO DISK = 'C:\backup.bak';

-- Restaurar
RESTORE DATABASE NomeBanco 
FROM DISK = 'C:\backup.bak';
Tabelas
sql
-- Criar tabela
CREATE TABLE Clientes (
    ID INT PRIMARY KEY IDENTITY(1,1),
    Nome VARCHAR(100) NOT NULL,
    Email VARCHAR(100) UNIQUE,
    DataNasc DATE,
    Salario DECIMAL(10,2)
);

-- Adicionar coluna
ALTER TABLE Clientes 
ADD Telefone VARCHAR(20);

-- Modificar coluna
ALTER TABLE Clientes 
ALTER COLUMN Nome VARCHAR(150);

-- Excluir coluna
ALTER TABLE Clientes 
DROP COLUMN Telefone;

-- Excluir tabela
DROP TABLE Clientes;

-- Criar √≠ndice
CREATE INDEX IX_Clientes_Nome 
ON Clientes(Nome);

-- Criar view
CREATE VIEW vw_ClientesAtivos AS
SELECT * FROM Clientes 
WHERE Ativo = 1;
üìä COMANDOS DE MANIPULA√á√ÉO (DML)
CRUD B√°sico
sql
-- Inserir dados
INSERT INTO Clientes (Nome, Email) 
VALUES ('Jo√£o Silva', 'joao@email.com');

-- Inserir m√∫ltiplos
INSERT INTO Clientes (Nome, Email)
VALUES 
    ('Maria Santos', 'maria@email.com'),
    ('Pedro Costa', 'pedro@email.com');

-- Consultar dados
SELECT * FROM Clientes;
SELECT Nome, Email FROM Clientes;
SELECT TOP 10 * FROM Clientes;

-- Com condi√ß√µes
SELECT * FROM Clientes 
WHERE Cidade = 'S√£o Paulo' 
AND Salario > 3000;

-- Com ordena√ß√£o
SELECT * FROM Clientes 
ORDER BY Nome ASC, DataCadastro DESC;

-- Atualizar dados
UPDATE Clientes 
SET Salario = Salario * 1.10 
WHERE Departamento = 'TI';

-- Excluir dados
DELETE FROM Clientes 
WHERE DataCadastro < '2020-01-01';
üîç COMANDOS DE CONSULTA AVAN√áADOS
Jun√ß√µes (JOINs)
sql
-- INNER JOIN
SELECT c.Nome, p.Produto, p.Valor
FROM Clientes c
INNER JOIN Pedidos p ON c.ID = p.ClienteID;

-- LEFT JOIN
SELECT d.Nome, COUNT(f.ID) AS QtdeFuncionarios
FROM Departamentos d
LEFT JOIN Funcionarios f ON d.ID = f.DepartamentoID
GROUP BY d.Nome;

-- RIGHT JOIN e FULL JOIN tamb√©m dispon√≠veis
Agrega√ß√µes
sql
-- Fun√ß√µes agregadas
SELECT 
    COUNT(*) AS Total,
    AVG(Salario) AS MediaSalarial,
    SUM(Salario) AS FolhaTotal,
    MIN(Salario) AS MenorSalario,
    MAX(Salario) AS MaiorSalario
FROM Funcionarios;

-- GROUP BY
SELECT 
    Departamento,
    COUNT(*) AS QtdeFuncionarios,
    AVG(Salario) AS MediaSalarial
FROM Funcionarios
GROUP BY Departamento
HAVING AVG(Salario) > 5000;  -- Filtro p√≥s-agrega√ß√£o
Subconsultas
sql
-- Subconsulta escalar
SELECT Nome, Salario,
    (SELECT AVG(Salario) FROM Funcionarios) AS MediaGeral
FROM Funcionarios;

-- Subconsulta na cl√°usula WHERE
SELECT * FROM Produtos
WHERE Preco > (SELECT AVG(Preco) FROM Produtos);

-- EXISTS
SELECT * FROM Clientes c
WHERE EXISTS (
    SELECT 1 FROM Pedidos p 
    WHERE p.ClienteID = c.ID
);
‚öôÔ∏è COMANDOS DE ADMINISTRA√á√ÉO
Sess√µes e Processos
sql
-- Ver processos ativos
EXEC sp_who;
EXEC sp_who2;

-- Ver conex√µes
SELECT * FROM sys.dm_exec_sessions;

-- Matar processo
KILL 53;  -- SPID do processo

-- Ver queries em execu√ß√£o
SELECT * FROM sys.dm_exec_requests;
Permiss√µes
sql
-- Conceder permiss√µes
GRANT SELECT, INSERT ON Clientes TO Usuario;
GRANT EXECUTE ON sp_Procedure TO RoleDB;

-- Revogar permiss√µes
REVOKE DELETE ON Clientes FROM Usuario;

-- Negar permiss√£o
DENY ALTER ON DATABASE::MeuBanco TO Usuario;

-- Criar login e usu√°rio
CREATE LOGIN novoLogin WITH PASSWORD = 'senhaForte123';
CREATE USER novoUsuario FOR LOGIN novoLogin;
Monitoramento
sql
-- Espa√ßo em disco
EXEC sp_spaceused 'Clientes';  -- Tabela espec√≠fica
EXEC sp_spaceused;             -- Banco atual

-- Estat√≠sticas de √≠ndice
DBCC SHOW_STATISTICS ('Clientes', 'IX_Nome');

-- Integridade do banco
DBCC CHECKDB ('NomeBanco');

-- Limpar cache
DBCC FREEPROCCACHE;   -- Cache de planos
DBCC DROPCLEANBUFFERS; -- Cache de buffers
üìà COMANDOS DE OTIMIZA√á√ÉO
Plano de Execu√ß√£o
sql
-- Habilitar estat√≠sticas
SET STATISTICS IO ON;
SET STATISTICS TIME ON;

-- Ver plano de execu√ß√£o real
-- (Ativar com Ctrl+M ou no menu Query -> Include Actual Execution Plan)

-- For√ßar √≠ndice
SELECT * FROM Clientes WITH (INDEX(IX_Nome))
WHERE Nome LIKE 'A%';

-- Atualizar estat√≠sticas
UPDATE STATISTICS Clientes;
üîß COMANDOS DO SISTEMA
Informa√ß√µes do Sistema
sql
-- Vers√£o do SQL Server
SELECT @@VERSION;

-- Nome do servidor
SELECT @@SERVERNAME;

-- ID da sess√£o
SELECT @@SPID;

-- Data/hora
SELECT GETDATE();
SELECT SYSDATETIME();

-- Usu√°rio atual
SELECT SUSER_NAME();
SELECT CURRENT_USER;
Vari√°veis de Configura√ß√£o
sql
-- Ver configura√ß√µes
EXEC sp_configure;

-- Habilitar op√ß√µes avan√ßadas
EXEC sp_configure 'show advanced options', 1;
RECONFIGURE;

-- Alterar configura√ß√£o
EXEC sp_configure 'max server memory', 8192;
RECONFIGURE;
üìÅ COMANDOS DE ARQUIVOS E BACKUP
Manipula√ß√£o de Arquivos
sql
-- Ver arquivos do banco
SELECT name, physical_name, size/128.0 AS SizeMB
FROM sys.database_files;

-- Adicionar arquivo de dados
ALTER DATABASE MeuBanco
ADD FILE (
    NAME = MeuBanco_Dados2,
    FILENAME = 'C:\Data\MeuBanco_Dados2.ndf',
    SIZE = 100MB,
    MAXSIZE = UNLIMITED,
    FILEGROWTH = 10%
);

-- Reduzir arquivo
DBCC SHRINKFILE (N'MeuBanco_Log', 100);  -- Reduzir para 100MB
üîÑ COMANDOS DE TRANSA√á√ÉO
sql
-- Iniciar transa√ß√£o
BEGIN TRANSACTION;

-- Confirmar transa√ß√£o
COMMIT TRANSACTION;

-- Desfazer transa√ß√£o
ROLLBACK TRANSACTION;

-- Ponto de salvamento
SAVE TRANSACTION PontoSalvamento;
ROLLBACK TRANSACTION PontoSalvamento;

-- N√≠vel de isolamento
SET TRANSACTION ISOLATION LEVEL READ COMMITTED;
SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;
üìã COMANDOS DE METADADOS
sql
-- Listar tabelas
SELECT * FROM INFORMATION_SCHEMA.TABLES;

-- Listar colunas
SELECT * FROM INFORMATION_SCHEMA.COLUMNS 
WHERE TABLE_NAME = 'Clientes';

-- Listar procedures
SELECT * FROM sys.procedures;

-- Listar views
SELECT * FROM sys.views;

-- Listar √≠ndices
EXEC sp_helpindex 'Clientes';

-- Depend√™ncias
EXEC sp_depends 'NomeTabela';
üéØ COMANDOS DE DIAGN√ìSTICO
sql
-- Ver √∫ltimo erro
SELECT @@ERROR;

-- Ver linha afetada
SELECT @@ROWCOUNT;

-- Ver identidade atual
SELECT @@IDENTITY;
SELECT SCOPE_IDENTITY();

-- Ver tempo de compila√ß√£o
SELECT cpu_time, total_elapsed_time
FROM sys.dm_exec_requests
WHERE session_id = @@SPID;
üí° DICAS DE ATALHOS DO SSMS
Teclas de Atalho:
F5 ou Ctrl+E - Executar query

Ctrl+R - Mostrar/ocultar painel de resultados

Ctrl+N - Nova janela de query

Ctrl+T - Resultados em texto

Ctrl+D - Resultados em grade

Ctrl+Shift+R - Atualizar cache do IntelliSense

Ctrl+K, Ctrl+C - Comentar linhas

Ctrl+K, Ctrl+U - Descomentar linhas

Comandos Pr√°ticos Di√°rios:
sql
-- Verificar espa√ßo das tabelas
EXEC sp_MSforeachtable 'EXEC sp_spaceused [?]';

-- Gerar script de cria√ß√£o de tabela
SELECT 'CREATE TABLE ' + TABLE_NAME + ' (' +
STRING_AGG(COLUMN_NAME + ' ' + DATA_TYPE + 
CASE WHEN CHARACTER_MAXIMUM_LENGTH IS NOT NULL 
THEN '(' + CAST(CHARACTER_MAXIMUM_LENGTH AS VARCHAR) + ')' 
ELSE '' END, ', ') WITHIN GROUP (ORDER BY ORDINAL_POSITION)
+ ');'
FROM INFORMATION_SCHEMA.COLUMNS
WHERE TABLE_NAME = 'Clientes'
GROUP BY TABLE_NAME;

-- Backup de todas as tabelas para outra base
SELECT 'SELECT * INTO BackupDB.dbo.' + name + 
' FROM ' + name + ';'
FROM sys.tables;
‚ö†Ô∏è COMANDOS PERIGOSOS (USE COM CAUTELA)
sql
-- Desabilitar constraints
ALTER TABLE Clientes NOCHECK CONSTRAINT ALL;

-- Habilitar constraints
ALTER TABLE Clientes CHECK CONSTRAINT ALL;

-- Truncar tabela (n√£o pode ser desfeito!)
TRUNCATE TABLE Clientes;

-- Reconstruir √≠ndice online
ALTER INDEX ALL ON Clientes REBUILD WITH (ONLINE = ON);

-- For√ßar failover (em AlwaysOn)
ALTER AVAILABILITY GROUP MeuAG FAILOVER;

*************************** COMANDOS *********************************
