*************************** INÍCIO COMANDOS *********************************
-- Qual bd estou?              
SELECT DB_NAME();

-- Listar todos os bd
SELECT name FROM sys.databases ORDER BY name;

-- Conecte ao banco nome_do_banco
USE nome_do_banco;

-- Informações completas
EXEC sp_helpdb 'nome_do_banco';

-- Top 10 linhas
SELECT TOP 10 * FROM nome_da_tabela

-- Seleção Distinta remove duplicatas dos resultados
-- Lista todas as UREs únicas
SELECT DISTINCT NOME_URE
FROM #ESCOLAS
ORDER BY NOME_URE;

-- Seleção Distinta DE Combinações únicas de múltiplas colunas
SELECT DISTINCT 
    NOME_URE,
    TIPO_ESCOLA,
    CATEGORIA
FROM #ESCOLAS
ORDER BY NOME_URE, TIPO_ESCOLA;

-- Limpar a tabela criada
DROP TABLE #temp_nome;

-- Limpar tabela recriá-la em looping
DROP TABLE IF EXISTS #temp_01
SELECT * INTO #temp_01 FROM nome_da_tabela

-- ORDENAR COLUNA
SELECT coluna1, coluna2, ...
FROM nome_da_tabela
ORDER BY coluna1 [ASC|DESC], coluna2 [ASC|DESC], ...; -- se não tiver nada, ASC é o padrão

-- Ordenação por múltiplas colunas
SELECT coluna1, coluna2, coluna3, ...
FROM nome_da_tabela
ORDER BY coluna1 ASC, coluna2 DESC, coluna3 ASC, ...;  -- se não tiver nada, ASC é o padrão

-- ISNULL
ISNULL(FORMAT(A.DTPOSSE_C,'dd/MM/yyyy'),'') AS DTPOSSE,

-- Criar temporária 
CREATE TABLE #temp_nome AS
SELECT * FROM  nome_do_banco;


*************************** FIM COMANDOS *********************************

*************************** INÍCIO COMANDOS ELABORADOS *********************************
-- Criação de e-mails
SELECT TOP 10 *, -- Seleciona as 10 primeiras linhas da consulta, e todas as colunas (*)            
              CASE  -- Inicia um CASE para lógica condicional                  
                  WHEN CATESC='VINCULADA' THEN -- Condição: quando a coluna CATESC for igual a 'VINCULADA' então
                      CONCAT('e', FORMAT(ESCVINC, '000000'), 'a@educacao.sp.gov.br') -- Se acima for verdadeiro: cria um email concatenando String 'e' com o número de ESCVINC em 6 dígitos (preenche com zeros à esquerda se ESCVINC < 6 dígitos) concatena com String 'a@educacao.sp.gov.br'                
                  ELSE -- Se falso:
                      CONCAT('e', FORMAT(CODESC, '000000'), 'a@educacao.sp.gov.br')   -- cria um email concatenando String 'e' com o número de CODESC em 6 dígitos (preenche com zeros à esquerda se CODESC < 6 dígitos) concatena com String 'a@educacao.sp.gov.br'      
              END               
              AS EMAIL -- Nome da nova coluna calculada como 'EMAIL'
FROM dbo.nome_do_esquema -- Especifica a tabela de origem com esquema dbo

-- Criar temporária com valores específicos da coluna de interesse
CREATE TABLE #temp_nome AS
SELECT * 
FROM nome_do_banco 
WHERE NOME_DA_COLUNA IN (
    'dado_pesquisado_01', 
    'dado_pesquisado_02', 
    'dado_pesquisado_03' 
);

-- Criar temporária com as colunas desejadas
SELECT 
    NOME DA COLUNA01 AS NOVO NOME01,
    NOME DA COLUNA02 AS NOVO NOME02,
    NOME DA COLUNA03 AS NOVO NOME03
INTO #temp_nome
FROM nome_do_banco;

-- Filtra os registros onde a coluna NOME_DA_COLUNA é igual a dado_pesquisado_01
USE nome_do_banco;
WHERE NOME_DA_COLUNA = dado_pesquisado_01

-- pesquisar se a coluna (por exemplo a terceira) tem trechos dos dados de interesse
SELECT NOME_DA_COLUNA01, NOME_DA_COLUNA02,  NOME_DA_COLUNA03, NOME_DA_COLUNA04
FROM nome_do_banco
WHERE NOME_DA_COLUNA03 LIKE '%dado_pesquisado_01%'
   OR NOME_DA_COLUNA03 LIKE '%dado_pesquisado_02%'
   OR NOME_DA_COLUNA03 LIKE '%dado_pesquisado_03%'
   OR NOME_DA_COLUNA03 LIKE '%dado_pesquisado_04%'
ORDER BY NOME_DA_COLUNA01;    

-- Listar todas as tabelas do nome_banco
SELECT TABLE_SCHEMA, TABLE_NAME 
FROM INFORMATION_SCHEMA.TABLES 
WHERE TABLE_TYPE = 'BASE TABLE'
ORDER BY TABLE_NAME;

-- Listar todos os esmquemas do nome_banco
SELECT DISTINCT TABLE_SCHEMA 
FROM INFORMATION_SCHEMA.TABLES 
WHERE TABLE_NAME = 'TB_ESCOLA'
ORDER BY TABLE_SCHEMA;

 -- Agrupamento de dados
SELECT coluna1, coluna2, função_agregação(coluna3)
FROM nome_da_tabela
GROUP BY coluna1, coluna2;
    -- exemplo de agrupamento
SELECT 
    CD_URE,
    NOME_URE,
    COUNT(*) AS TOTAL_ESCOLAS
FROM #ESCOLAS
GROUP BY CD_URE, NOME_URE
ORDER BY TOTAL_ESCOLAS DESC;

-- Filtro WHERE
SELECT 
    CD_URE,
    NOME_URE,
    CODESC,
    NOMESC,
    TIPO_ESCOLA,
    MODALIDADE
FROM #ESCOLAS
WHERE -- WHERE sempre vem depois do FROM e antes do GROUP BY/ORDER BY
    NOME_URE = 'NORTE 1'  -- Filtra apenas escolas da URE NORTE 1
    AND TIPO_ESCOLA = 8   -- E apenas do tipo 8
    AND CODESC > 100      -- E com código maior que 100
ORDER BY CODESC;

-- Exemplo 2: WHERE com múltiplas condições e operadores
SELECT *
FROM #ESCOLAS
WHERE 
    -- Usando OR para múltiplas UREs
    (NOME_URE = 'NORTE 1' OR NOME_URE = 'SUL 1')
    -- Usando BETWEEN para intervalo
    AND CODESC BETWEEN 100 AND 500
    -- Usando LIKE para padrão de texto
    AND NOMESC LIKE '%PROFESSOR%'  -- Escolas que contém "PROFESSOR" no nome
    -- Usando IN para lista de valores
    AND TIPO_ESCOLA IN (8, 9, 10)
    -- Usando NOT para exclusão
    AND CATEGORIA NOT IN ('VINCULADA', 'EXTINTA');

-- filtro em grupos HAVING 
SELECT 
    NOME_URE,
    TIPO_ESCOLA,
    COUNT(*) AS TOTAL
FROM #ESCOLAS
GROUP BY NOME_URE, TIPO_ESCOLA
HAVING COUNT(*) > 5  -- Filtra apenas grupos com mais de 5 escolas
ORDER BY TOTAL DESC;

-- CONCAT: concatena strings 
SELECT 
    CODESC,
    NOMESC,
    -- CONCAT automaticamente trata NULLs como strings vazias
    CONCAT('Código: ', CODESC, ' - ', NOMESC) AS DESCRICAO_COMPLETA,
    -- Exemplo com dados reais
    CONCAT(
        'Escola: ', NOMESC, 
        ' | URE: ', NOME_URE,
        ' | Tipo: ', TIPO_ESCOLA
    ) AS INFO_ESCOLA
FROM #ESCOLAS;

-- LEFT Extrai caracteres do início da string
SELECT 
    -- Exemplo: pegar apenas os primeiros 12 caracteres do RG
    LEFT(NR_RG, 12) AS RG_TRUNCADO,
    -- Exemplo prático com nomes: primeiras 3 letras da URE
    LEFT(NOME_URE, 3) AS SIGLA_URE,
    -- Exemplo: código reduzido (primeiros 3 dígitos)
    LEFT(CODESC, 3) AS PREFIXO_CODIGO,
    -- Combine com outras funções
    CONCAT(
        LEFT(NOME_URE, 3),  -- Primeiras 3 letras da URE
        '-',
        LEFT(NOMESC, 10)    -- Primeiras 10 letras da escola
    ) AS CODIGO_REDUZIDO
FROM #ESCOLAS A;

-- CASE: if/else do SQL
SELECT 
    CODESC,
    NOMESC,
    TIPO_ESCOLA,
    -- Sintaxe básica do CASE
    CASE TIPO_ESCOLA
        WHEN 8 THEN 'ENSINO REGULAR'
        WHEN 9 THEN 'ENSINO INTEGRAL'
        WHEN 10 THEN 'EDUCAÇÃO ESPECIAL'
        ELSE 'OUTROS TIPOS'
    END AS DESCRICAO_TIPO,

-- LEFT JOIN: todos da tabela A + correspondentes de B
-- Supondo: CEPEA_SAS.dbo.CTG0126 tem dados de contratação
--        CEPEA_SAS.dbo.ESCOLAS0126 tem dados de escolas
SELECT 
    -- Dados da tabela A (CTG0126)
    A.CD_CONTRATO,
    A.NR_RG,
    LEFT(A.NR_RG, 12) AS RG_FORMATADO,  -- Aplicando LEFT no RG
    A.NM_SERVIDOR,
    A.DT_ADMISSAO,
    
    -- Dados da tabela B (ESCOLAS0126)
    B.CODESC,
    B.NOMESC,
    B.NOMEDE,
    B.TPESC,
    
    -- Campos calculados
    DATEDIFF(YEAR, A.DT_ADMISSAO, GETDATE()) AS TEMPO_SERVICO,
    
    -- CASE com dados das duas tabelas
    CASE 
        WHEN B.TPESC = 8 THEN 'LOTADO EM ESCOLA REGULAR'
        WHEN B.TPESC = 9 THEN 'LOTADO EM INTEGRAL'
        WHEN B.CODESC IS NULL THEN 'SEM LOTACAO'
        ELSE 'OUTRA LOTACAO'
    END AS STATUS_LOTACAO
    
FROM CEPEA_SAS.dbo.CTG0126 AS A  -- Tabela A (contratações)
LEFT JOIN CEPEA_SAS.dbo.ESCOLAS0126 AS B  -- Tabela B (escolas)
    ON A.CODESC = B.CODESC  -- Condição de junção    
WHERE A.DT_ADMISSAO > '2020-01-01'
ORDER BY A.NM_SERVIDOR;

-- LEFT JOIN EX:.2: Exemplo com múltiplos JOINS
SELECT 
    C.*,
    E.NOMESC,
    D.NM_DIRETORIA
FROM CEPEA_SAS.dbo.CTG0126 AS C
LEFT JOIN CEPEA_SAS.dbo.ESCOLAS0126 AS E
    ON C.CODESC = E.CODESC
LEFT JOIN [012026].[TB_DIRETORIA] AS D
    ON E.CD_DIRETORIA = D.CD_DIRETORIA
WHERE C.DT_ADMISSAO IS NOT NULL;

-- UNION: combina resultados de múltiplas queries (remove duplicatas)
-- UNION ALL: mantém duplicatas (mais rápido)

        -- Exemplo: lista combinada de UREs de diferentes fontes
        SELECT 
            CD_URE AS CODIGO,
            NOME_URE AS NOME,
            'TABELA_ESCOLAS' AS FONTE
        FROM #ESCOLAS
        WHERE NOME_URE LIKE 'NORTE%'
        
        UNION  -- Remove duplicatas entre os conjuntos
        
        SELECT 
            CD_DIRETORIA AS CODIGO,
            NM_DIRETORIA AS NOME,
            'TB_DIRETORIA' AS FONTE
        FROM [012026].[TB_DIRETORIA]
        WHERE NM_DIRETORIA LIKE 'NORTE%'
        
        ORDER BY NOME, FONTE;
        
        -- UNION ALL mantém todos os registros (inclusive duplicados)
        SELECT CODESC, NOMESC FROM #ESCOLAS WHERE NOME_URE = 'NORTE 1'
        UNION ALL
        SELECT CODESC, NOMESC FROM ESCOLAS1225 WHERE NOMEDE = 'NORTE 1'
        ORDER BY CODESC;
        
-- Regras do UNION:
-- 1. Mesmo número de colunas em cada SELECT
-- 2. Tipos de dados compatíveis nas colunas correspondentes
-- 3. Ordem das colunas deve corresponder

*************************** FIM COMANDOS ELABORADOS *********************************
